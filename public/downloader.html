<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Downloader - TRS</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background: #000; color: #fff; font-family: sans-serif; }
.card { background: #1a1a1a; padding: 1.5rem; border-radius: 10px; width: 100%; max-width: 500px; margin-bottom: 1rem; }
.card a { display: inline-block; background: #ffdd00; color: #111; padding: 0.5rem 1rem; border-radius: 5px; font-weight: bold; text-decoration: none; margin-top: 0.5rem; }
.card a:hover { background: #ffaa00; color: #000; }
</style>
</head>
<body class="flex flex-col items-center py-10">

<h1 class="text-yellow-400 text-4xl font-bold mb-4">Video Downloader</h1>
<p class="text-gray-300 mb-6">Paste a TikTok, Facebook, or Instagram video URL below.</p>

<form id="video-form" class="flex flex-col md:flex-row gap-2 mb-6">
  <input type="url" id="video-url" placeholder="Paste video URL" class="p-3 rounded text-black w-full md:w-96" required>
  <button type="submit" class="bg-yellow-400 text-black px-6 py-2 rounded font-bold">Download</button>
</form>

<div id="video-links" class="flex flex-col items-center w-full max-w-md"></div>

<script>
const form = document.getElementById("video-form");
const videoLinks = document.getElementById("video-links");

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const url = document.getElementById("video-url").value.trim();
  if (!url) return alert("Please enter a video URL");

  videoLinks.innerHTML = `<p class="text-gray-300">Fetching download links...</p>`;

  try {
    const res = await fetch(`/api/media?url=${encodeURIComponent(url)}`);
    const data = await res.json();

    if(data.success && data.result){
      const v = data.result;
      videoLinks.innerHTML = '';

      if(v.no_watermark_video){
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <h3>${v.title || 'Video (No Watermark)'}</h3>
          ${v.cover ? `<img src="${v.cover}" alt="Thumbnail" class="mb-2 rounded w-full">` : ''}
          <a href="${v.no_watermark_video}" download>Download Video</a>
          ${v.author ? `<p class="mt-2 text-gray-400 text-sm">Author: ${v.author.nickname}</p>` : ''}
        `;
        videoLinks.appendChild(div);
      }

      if(v.audio){
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<h3>Audio</h3><a href="${v.audio}" download>Download Audio</a>`;
        videoLinks.appendChild(div);
      }

    } else {
      videoLinks.innerHTML = `<p class="text-red-500">Failed to fetch video link.</p>`;
    }

  } catch(err){
    console.error(err);
    videoLinks.innerHTML = `<p class="text-red-500">Error fetching video. Try again later.</p>`;
  }
});
</script>

</body>
</html>
